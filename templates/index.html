<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TextTalker - Advanced Text to Speech</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        :root {
            --bg-color: #ffffff;
            --text-color: #212529;
            --card-bg: #f8f9fa;
            --border-color: #dee2e6;
        }

        [data-bs-theme="dark"] {
            --bg-color: #000000;
            --text-color: #ffffff;
            --card-bg: #1a1a2e;
            --border-color: #16213e;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.3s, color 0.3s;
        }

        .card {
            background-color: var(--card-bg);
            border-color: var(--border-color);
        }

        .sidebar {
            position: fixed;
            top: 0;
            right: -300px;
            width: 300px;
            height: 100vh;
            background-color: var(--card-bg);
            border-left: 1px solid var(--border-color);
            transition: right 0.3s;
            z-index: 1050;
            overflow-y: auto;
        }

        .sidebar.show {
            right: 0;
        }

        .custom-audio-player {
            width: 100%;
            margin: 10px 0;
        }

        .history-item {
            padding: 10px;
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
        }

        .history-item:hover {
            background-color: rgba(0, 123, 255, 0.1);
        }

        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1030;
        }

        .file-upload-area {
            border: 2px dashed var(--border-color);
            border-radius: 5px;
            padding: 20px;
            text-align: center;
            transition: border-color 0.3s;
        }

        .file-upload-area:hover {
            border-color: #007bff;
        }

        .file-upload-area.dragover {
            border-color: #007bff;
            background-color: rgba(0, 123, 255, 0.1);
        }
    </style>
</head>
<body>
    <!-- Theme Toggle -->
    <button class="btn btn-outline-secondary theme-toggle" id="themeToggle">
        <i class="bi bi-moon-fill"></i>
    </button>

    <!-- Sidebar -->
    <div class="sidebar" id="historySidebar">
        <div class="p-3">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h5 class="mb-0">Conversion History</h5>
                <div>
                    <button class="btn btn-sm btn-outline-danger me-2" id="clearAllHistoryBtn" title="Clear all history">
                        <i class="bi bi-trash3-fill"></i> Clear All
                    </button>
                    <button class="btn btn-close" id="closeSidebar"></button>
                </div>
            </div>
            <div id="historyList">
                <p class="text-muted">No conversions yet</p>
            </div>
        </div>
    </div>

    <div class="container-fluid py-4">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="text-center mb-4">
                    <h1 class="display-4">TextTalker</h1>
                    <p class="lead">Advanced Text to Speech Converter</p>
                </div>

                <!-- Navigation Tabs -->
                <ul class="nav nav-tabs mb-4" id="inputTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="text-tab" data-bs-toggle="tab" data-bs-target="#text" type="button" role="tab">Text Input</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="file-tab" data-bs-toggle="tab" data-bs-target="#file" type="button" role="tab">File Upload</button>
                    </li>
                </ul>

                <!-- Tab Content -->
                <div class="tab-content" id="inputTabsContent">
                    <!-- Text Input Tab -->
                    <div class="tab-pane fade show active" id="text" role="tabpanel">
                        <div class="card">
                            <div class="card-body">
                                <form id="textForm">
                                    <div class="mb-3">
                                        <label for="textInput" class="form-label">Enter Text</label>
                                        <textarea class="form-control" id="textInput" name="text" rows="6" placeholder="Enter text to convert to speech..." required></textarea>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-4 mb-3">
                                            <label for="languageSelect" class="form-label">Language</label>
                                            <select class="form-select" id="languageSelect" name="language">
                                                <option value="en">English</option>
                                                <option value="es">Spanish</option>
                                                <option value="fr">French</option>
                                                <option value="de">German</option>
                                                <option value="it">Italian</option>
                                                <option value="pt">Portuguese</option>
                                                <option value="ru">Russian</option>
                                                <option value="ja">Japanese</option>
                                                <option value="ko">Korean</option>
                                                <option value="zh-cn">Chinese (Simplified)</option>
                                                <option value="ar">Arabic</option>
                                            </select>
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <label for="emotionSelect" class="form-label">Emotion</label>
                                            <select class="form-select" id="emotionSelect" name="emotion">
                                                <option value="neutral">Neutral</option>
                                                <option value="happy">Happy üòä</option>
                                                <option value="sad">Sad üò¢</option>
                                                <option value="excited">Excited ü§©</option>
                                                <option value="calm">Calm üòå</option>
                                                <option value="angry">Angry üò†</option>
                                                <option value="surprised">Surprised üò≤</option>
                                                <option value="serious">Serious üòê</option>
                                            </select>
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <label class="form-label">Options</label>
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="slowMode" name="slow" value="true">
                                                <label class="form-check-label" for="slowMode">
                                                    Slow Mode
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                    <button type="submit" class="btn btn-primary w-100" id="convertBtn">
                                        <i class="bi bi-play-circle me-2"></i>Convert to Speech
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>

                    <!-- File Upload Tab -->
                    <div class="tab-pane fade" id="file" role="tabpanel">
                        <div class="card">
                            <div class="card-body">
                                <form id="fileForm">
                                    <div class="mb-3">
                                        <label class="form-label">Upload File (.txt or .pdf)</label>
                                        <div class="file-upload-area" id="fileUploadArea">
                                            <i class="bi bi-cloud-upload fs-1 text-muted mb-2"></i>
                                            <p class="mb-1">Drag & drop a file here or click to browse</p>
                                            <p class="text-muted small">Supported formats: .txt, .pdf</p>
                                            <input type="file" class="d-none" id="fileInput" name="file" accept=".txt,.pdf" required>
                                        </div>
                                        <div class="mt-2" id="fileName"></div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label for="fileLanguageSelect" class="form-label">Language</label>
                                            <select class="form-select" id="fileLanguageSelect" name="language">
                                                <option value="en">English</option>
                                                <option value="es">Spanish</option>
                                                <option value="fr">French</option>
                                                <option value="de">German</option>
                                                <option value="it">Italian</option>
                                                <option value="pt">Portuguese</option>
                                                <option value="ru">Russian</option>
                                                <option value="ja">Japanese</option>
                                                <option value="ko">Korean</option>
                                                <option value="zh-cn">Chinese (Simplified)</option>
                                                <option value="ar">Arabic</option>
                                            </select>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label">Options</label>
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="fileSlowMode" name="slow" value="true">
                                                <label class="form-check-label" for="fileSlowMode">
                                                    Slow Mode
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                    <button type="submit" class="btn btn-primary w-100" id="fileConvertBtn">
                                        <i class="bi bi-play-circle me-2"></i>Convert File to Speech
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Result Section -->
                <div class="card mt-4" id="resultCard" style="display: none;">
                    <div class="card-body">
                        <h5 class="card-title">Conversion Result</h5>
                        <div id="resultContent"></div>
                        <div class="mt-3">
                            <button class="btn btn-outline-primary me-2" id="historyBtn">
                                <i class="bi bi-clock-history me-1"></i>View History
                            </button>
                            <button class="btn btn-outline-secondary" id="downloadBtn" style="display: none;">
                                <i class="bi bi-download me-1"></i>Download
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>const themeToggle=document.getElementById('themeToggle'),html=document.documentElement;themeToggle.addEventListener('click',()=>{const t=html.getAttribute('data-bs-theme'),n=t==='dark'?'light':'dark';html.setAttribute('data-bs-theme',n),themeToggle.innerHTML=n==='dark'?'<i class="bi bi-sun-fill"></i>':'<i class="bi bi-moon-fill"></i>',localStorage.setItem('theme',n)});const savedTheme=localStorage.getItem('theme')||'light';html.setAttribute('data-bs-theme',savedTheme),themeToggle.innerHTML=savedTheme==='dark'?'<i class="bi bi-sun-fill"></i>':'<i class="bi bi-moon-fill"></i>';const fileUploadArea=document.getElementById('fileUploadArea'),fileInput=document.getElementById('fileInput'),fileName=document.getElementById('fileName');fileUploadArea.addEventListener('click',()=>fileInput.click()),fileUploadArea.addEventListener('dragover',e=>{e.preventDefault(),fileUploadArea.classList.add('dragover')}),fileUploadArea.addEventListener('dragleave',()=>fileUploadArea.classList.remove('dragover')),fileUploadArea.addEventListener('drop',e=>{e.preventDefault(),fileUploadArea.classList.remove('dragover');const t=e.dataTransfer.files;t.length>0&&(fileInput.files=t,updateFileName())}),fileInput.addEventListener('change',updateFileName);function updateFileName(){const e=fileInput.files[0];fileName.innerHTML=e?`<small class="text-muted">Selected: ${e.name}</small>`:''}async function submitForm(e,t=!1){const n=new FormData(e),o=document.getElementById('resultCard'),r=document.getElementById('resultContent'),c=t?document.getElementById('fileConvertBtn'):document.getElementById('convertBtn'),d=c.innerHTML;c.disabled=!0,c.innerHTML='<i class="bi bi-hourglass-split me-2"></i>Converting...';try{const e=await fetch('/convert',{method:'POST',body:n}),t=await e.json();if(e.ok){r.innerHTML=`<div class="alert alert-success"><i class="bi bi-check-circle me-2"></i>Conversion successful!</div><div class="custom-audio-player"><audio controls class="w-100"><source src="${t.file_path}" type="audio/mpeg">Your browser does not support the audio element.</audio></div>`,o.style.display='block',document.getElementById('downloadBtn').style.display='inline-block',document.getElementById('downloadBtn').onclick=()=>{const e=document.createElement('a');e.href=t.file_path,e.download='texttospeech.mp3',e.click()},loadHistory()}else r.innerHTML=`<div class="alert alert-danger"><i class="bi bi-exclamation-triangle me-2"></i>Error: ${t.error}</div>`,o.style.display='block'}catch(e){r.innerHTML=`<div class="alert alert-danger"><i class="bi bi-exclamation-triangle me-2"></i>Error: ${e.message}</div>`,o.style.display='block'}finally{c.disabled=!1,c.innerHTML=d}}document.getElementById('textForm').addEventListener('submit',e=>{e.preventDefault(),submitForm(e.target)}),document.getElementById('fileForm').addEventListener('submit',e=>{e.preventDefault(),submitForm(e.target,!0)});const historySidebar=document.getElementById('historySidebar'),historyBtn=document.getElementById('historyBtn'),closeSidebar=document.getElementById('closeSidebar'),clearAllHistoryBtn=document.getElementById('clearAllHistoryBtn');historyBtn.addEventListener('click',()=>{historySidebar.classList.add('show'),loadHistory()}),closeSidebar.addEventListener('click',()=>historySidebar.classList.remove('show')),clearAllHistoryBtn.addEventListener('click',clearAllHistory),document.addEventListener('click',e=>{!historySidebar.contains(e.target)&&e.target!==historyBtn&&historySidebar.classList.remove('show')});async function clearAllHistory(){if(!confirm('Are you sure you want to delete ALL history items? This will also delete all associated audio files and cannot be undone.'))return;try{const e=await fetch('/history',{method:'DELETE'});if(e.ok){const t=await e.json();alert(`Successfully cleared all history! Deleted ${t.deleted_count} items.`),loadHistory()}else{const t=await e.json();alert('Error clearing history: '+t.error)}}catch(e){console.error('Error clearing history:',e),alert('Error clearing history: '+e.message)}}async function loadHistory(){try{const e=await fetch('/history'),t=await e.json(),n=document.getElementById('historyList');if(t.length===0)return void(n.innerHTML='<p class="text-muted">No conversions yet</p>');n.innerHTML=t.map(e=>`<div class="history-item"><div class="d-flex justify-content-between align-items-start"><div class="flex-grow-1" onclick="playHistoryItem('${e.file_path}')" style="cursor: pointer;"><div class="d-flex justify-content-between mb-1"><small class="text-muted">${new Date(e.timestamp).toLocaleString()}</small><small class="badge bg-secondary">${e.language}</small></div><p class="mb-1">${e.text_preview}</p>${e.slow?'<small class="text-info"><i class="bi bi-turtle me-1"></i>Slow</small>':''}</div><button class="btn btn-sm btn-outline-danger ms-2" onclick="deleteHistoryItem(${e.id})" title="Delete this item"><i class="bi bi-trash"></i></button></div></div>`).join('')}catch(e){console.error('Error loading history:',e)}}async function deleteHistoryItem(e){if(!confirm('Are you sure you want to delete this history item? This will also delete the associated audio file.'))return;try{const t=await fetch(`/history/${e}`,{method:'DELETE'});t.ok?loadHistory():(t=await t.json(),alert('Error deleting history item: '+t.error))}catch(t){console.error('Error deleting history item:',t),alert('Error deleting history item: '+t.message)}}function playHistoryItem(e){const t=document.getElementById('resultContent');t.innerHTML=`<div class="alert alert-info"><i class="bi bi-play-circle me-2"></i>Playing from history</div><div class="custom-audio-player"><audio controls autoplay class="w-100"><source src="${e}" type="audio/mpeg">Your browser does not support the audio element.</audio></div>`,historySidebar.classList.remove('show')}loadHistory();</script>
</body>
</html>